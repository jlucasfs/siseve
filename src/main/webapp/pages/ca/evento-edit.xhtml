<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui" template="/pages/templates/ui.xhtml">
	<ui:define name="content">
		<script type="text/javascript">
			function goTopPage() {
				$( 'html, body' ).animate( { scrollTop: 0 }, 'slow' );
			}
		</script>
		
		<h2>Cadastro de Evento</h2>

		<h:form id="formcadEvento" styleClass="form-contour">
			<h:panelGrid styleClass="btnForm" columns="5" cellpadding="2" cellspacing="5">
				<p:commandButton value="#{msg['button.back']}" icon="ui-icon ui-icon-triangle-1-w" ajax="false" 
	               	action="#{eventoController.entrar}" immediate="true" />
				<p:commandButton value="#{msg['button.clear']}" update=":formcadEvento, :formcadImgs" 
					action="#{eventoController.limpar}" icon="botao-limpar-campos" process="@this" immediate="false" />
				<p:commandButton value="#{msg['button.save']}" update=":idmsg,@form,:formcadEvento,:formcadImgs" ajax="true"
					action="#{eventoController.salvar}" icon="ui-icon ui-icon-disk"
					process=":formcadEvento,:formcadImgs" oncomplete="goTopPage();" partialSubmit="true"/>
			</h:panelGrid>

			<p:panel header="Evento" styleClass="boxSubtit" id="panel">
            	<h:panelGrid columns="2" cellpadding="2" cellspacing="7">
	           		<h:outputLabel value="Descrição *:" />
					<h:outputLabel value="Data Evento :" />
					<p:inputText id='descricao' maxlength="100" size="69" value="#{eventoController.evento.descricao}" 
						required="true" requiredMessage="O campo 'Descrição' é obrigatório"/>
					<h:panelGrid columns="2" cellpadding="0" cellspacing="0">
						<p:calendar value="#{eventoController.evento.dtEvento}" showOn="both"
							pattern="dd/MM/yyyy" maxlength="10" size="11" popupIconOnly="true" 
							readOnlyInputText="false" navigator="true" locale="pt_BR" timeZone="America/Sao_Paulo" />
						<p:spacer width="5" />
					</h:panelGrid>
					<h:outputLabel value="Código HTML / Mensagem a ser enviada no corpo de e-mail: " />
					<h:outputLabel value="Observação: " />
					<p:inputTextarea id="mensgm" value="#{eventoController.evento.descMensagem}" 
						maxlength="50000" cols="200" maxHeight="100" rows="10" autoResize="false"
						style="margin:3px; max-width:440px;" />
					<p:inputTextarea id="observacao" value="#{eventoController.evento.observacao}" 
						maxlength="500" cols="200" maxHeight="100" rows="10" autoResize="false"
						style="margin:3px; max-width:400px;" />
				</h:panelGrid>
            </p:panel>
			<p:focus for=":formcadEvento:descricao" />
		</h:form>
		
		<h:form id="formcadImgs" enctype="multipart/form-data" styleClass="form-contour">
			<p:panel id="pnImagem" header="Imagens" styleClass="boxSubtit">
				<h:panelGrid columns="2" cellpadding="2" cellspacing="5" style="display: inline-block;">
			        <h:outputLabel value="Data : " />
			        <h:outputLabel value="Arquivo : " />
					<p:calendar id='dataimg' value="#{eventoController.eventoImagem.dtCadastro}" showOn="both"
						pattern="dd/MM/yyyy" maxlength="10" size="11" popupIconOnly="true"
						readOnlyInputText="false" navigator="true" locale="pt_BR" timeZone="America/Sao_Paulo" />
					<p:fileUpload id='arq' style="float:left;" update=":formcadImgs:outNomeArq"
						fileUploadListener="#{eventoController.handleFileUploader}"  
			            mode="advanced" sizeLimit="5000000" allowTypes="/(\.)(jp?g|jpe?g|png|pdf|bpt|html)$/"
			            auto="true" label="Importar arquivo" />
				</h:panelGrid>

				<h:panelGrid styleClass="btnForm" columns="5" cellpadding="2" cellspacing="5" style="display: inline-block;">
					<h:outputText id="outNomeArq" value="#{eventoController.eventoImagem.nomeImagem}" />
					<p:commandButton id="btnAddDoc" oncomplete="if($('#idmsg').html()!=''){goTopPage();}" 
						value="Incluir" process="@this, dataimg, arq" 
						action="#{eventoController.addImagem}"
						update=":idmsg,:formcadImgs:dataimg,:formcadImgs:arq,:formcadImgs:dtImgs,:formcadImgs:outNomeArq" />
				</h:panelGrid>

				<p:dataTable id="dtImgs" var="it" paginator="true" rows="5"
					emptyMessage="Nenhum registro selecionado" paginatorPosition="bottom"
					value="#{eventoController.evento.eventoImagensList}"
                	paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                	styleClass="gridContour" style="width:600px;"
	                rowIndexVar="rowIx" rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'even-row' : 'odd-row'}">
					<p:column headerText="Data" styleClass="gridHeaderName" style="width:70px; max-width:70px; min-width:70px;">
						<h:outputText value="#{it.dtCadastro}">
	                    	<f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR" timeZone="America/Sao_Paulo" />
	                    </h:outputText>
					</p:column>					                 
					<p:column headerText="Nome do arquivo">
						<h:outputText value="#{it.nomeImagem}" />
					</p:column>
					<p:column headerText="Ações" style="width:10px;">
   	    				<p:commandButton action="#{eventoController.deleteImagem}" icon="ui-icon ui-icon-close" 
							update=":formcadImgs:dtImgs" ajax="true" immediate="true">
							<f:setPropertyActionListener value="#{it}" target="#{eventoController.eventoImagemSelecionada}"/>
						</p:commandButton>
   	    				<p:commandButton action="#{eventoController.verImagem}" icon="ui-icon ui-icon-search" 
							update=":formcadImgs:dtImgs" ajax="false" immediate="true" onclick= "this.form.target='_blank'">
							<f:setPropertyActionListener value="#{it}" target="#{eventoController.eventoImagemSelecionada}"/>
						</p:commandButton>
   	    				<p:commandButton action="#{eventoController.baixarImagem}" icon="ui-icon ui-icon-arrowthickstop-1-s" 
							update=":formcadImgs:dtImgs" ajax="false">
							<f:setPropertyActionListener value="#{it}" target="#{eventoController.eventoImagemSelecionada}"/>
						</p:commandButton>
   	    			</p:column>						
				</p:dataTable>					
				
			</p:panel>
		
			<h:panelGrid styleClass="btnForm" columns="5" cellpadding="2" cellspacing="5">
	            <p:commandButton value="#{msg['button.back']}" icon="ui-icon ui-icon-triangle-1-w" ajax="false" 
	               	action="#{eventoController.entrar}" immediate="true" />
				<p:commandButton value="#{msg['button.clear']}" update=":formcadEvento, :formcadImgs" 
					action="#{eventoController.limpar}" icon="botao-limpar-campos" process="@this" immediate="false" />
				<p:commandButton value="#{msg['button.save']}" update=":idmsg,:formcadEvento,:formcadImgs" ajax="true"
					action="#{eventoController.salvar}" icon="ui-icon ui-icon-disk" partialSubmit="true"
					process=":formcadEvento,:formcadImgs" oncomplete="goTopPage();" />
			</h:panelGrid>

		</h:form>
	</ui:define>
</ui:composition>
